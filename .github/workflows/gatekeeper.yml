
name: Pernganuan Gatekeeper üõ°Ô∏è

on:
  pull_request:
    paths:
      - 'games/**'
      - 'package.json'
      - 'package-lock.json'

jobs:
  quality-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: üì¶ Check for Shadow Dependencies
        run: |
          # Pernganuan Rule: Zero Dependencies
          # Fail if package.json or lockfile is changed in this PR
          if git diff --name-only origin/main HEAD | grep -qE 'package(-lock)?\.json'; then
            echo "‚ùå ERROR: MODIFICATION OF PACKAGE.JSON DETECTED!"
            echo "We assume 'Zero Dependencies' policy for game submissions."
            echo "Please use existing libraries (Tone.js, Standard Utils) instead of adding new ones."
            exit 1
          else
            echo "‚úÖ Dependency Check Passed"
          fi

      - name: üëÆ Asset Cop (No Static Files)
        run: |
          # Pernganuan Rule: Procedural Over Static
          # Find any binary assets in the games folder
          FORBIDDEN_FILES=$(find games -type f \( -name "*.png" -o -name "*.jpg" -o -name "*.jpeg" -o -name "*.gif" -o -name "*.mp3" -o -name "*.wav" \))

          if [ -n "$FORBIDDEN_FILES" ]; then
            echo "‚ùå ERROR: STATIC ASSETS DETECTED!"
            echo "The following files are not allowed:"
            echo "$FORBIDDEN_FILES"
            echo "-----------------------------------"
            echo "Please remove them and use procedural drawing (ctx.fillRect) and synthesized audio (playSfx)."
            exit 1
          else
            echo "‚úÖ Asset Check Passed"
          fi

      - name: üîç Type Patrol (No Explicit Any)
        run: |
          # Pernganuan Rule: Strict Typing
          # Grep for ': any' or 'as any' in the games directory
          # We exclude this check script itself just in case

          if grep -rE ": any|as any" games/ --include="*.ts"; then
            echo "‚ùå ERROR: VISIBLE 'ANY' USAGE DETECTED!"
            echo "We enforce strict typing to keep the engine stable."
            echo "Please define proper interfaces for your entities."
            exit 1
          else
            echo "‚úÖ Type Check Passed"
          fi
